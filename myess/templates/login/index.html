<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" rel="external nofollow" href="/static/img/favicon.ico" />
    <link rel="stylesheet" href="/static/lib/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/lib/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/index1.css">
    <script src="/static/lib/jquery/2.1.4/jquery.min.js"></script>
    <script src="/static/lib/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <link href="/static/lib/layui-v2.7.6/layui/css/layui.css" rel="stylesheet">
    <script src="/static/lib/layui-v2.7.6/layui/layui.js"></script>
    <title>首页</title>
    <style>
        h3 {
            text-align: center;
        }

        table {
            table-layout: fixed;
        }

        thead tr th {
            position: sticky;
            background-color: #fff;
            top: 0;
        }
        .form-group {
            margin-left: 60px !important;
        }
        #left #updvis:hover{color: rgb(87,163,243) !important; cursor: pointer;}
    </style>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" onselectstart="return false">
        <!--onselectstrat 禁止选中-->
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#my-nav"
                    aria-expanded="false">
                    <span class="sr-only">切换导航条</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!-- <a class="navbar-brand" style="cursor:default;"> -->
                <img src="/static/img/logo_ess.png" alt="ESS" draggable="false">
                <!-- </a> -->
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="my-nav">
                <ul class="nav navbar-nav">
                    <li class="active"><a style="color: #fff; background-color: rgb(68, 147, 199);">首页</a></li>
                    <li class="active"><a href="/waibao">外包数据</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li style="border-right: 1px solid #bdbdbd; margin-right: 20px; cursor: pointer;"><a
                            onclick="help()">
                            <i class="fa fa-hand-o-right" style="margin-right: 5px; font-size: 18px;"></i>
                            <span style="font-size: 18px;">Help</span></a>
                    </li>
                    <li role="presentation" class="dropdown" style="width: 139px;">
                        <a class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                            style="text-align: center;">
                            <i class="fa fa-user" style="margin-left: -30px; font-size: 18px;"></i>
                            <span style="font-size: 18px; margin-left: 5px;" id="name"></span>
                            <span class="caret" style="margin-left: 10px;"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li style="border-bottom: 1px solid gray;">
                                <a href="/sites/" target="black" id="nav_setting">
                                    <i class="fa fa-gear"></i>
                                    <span style="margin-left: 10px;">设置</span>
                                </a>
                            </li>
                            <li style="border-bottom: 1px solid gray;" onclick="info()">
                                <a>
                                    <i class="fa fa-info-circle"></i>
                                    <span style="margin-left: 10px;">关于</span>
                                </a>
                            </li>
                            <li onclick="logout()">
                                <a>
                                    <i class="fa fa-sign-out"></i>
                                    <span style="margin-left: 10px;">注销</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
    <div id="body-div">
        <div id="left" onselectstart="return false">
            <label onclick="add_data_show()">
                <i class="fa fa-plus-square" aria-hidden="true"></i>
                <span>添加数据</span>
            </label>
            <label onclick="search_show()">
                <i class="fa fa-search" aria-hidden="true"></i>
                <span>搜索数据</span>
            </label>
            <label onclick="showData('gsdata_count')">
                <i class="fa fa-bar-chart" aria-hidden="true"></i>
                <span>图表展示</span>
            </label>
            <label onclick="showData('efficiency')">
                <i class="fa fa-paw" aria-hidden="true"></i>
                <span>团队效率</span>
            </label>
            <label onclick="showData('performance')">
                <i class="fa fa-diamond" aria-hidden="true"></i>
                <span>个人绩效</span>
            </label>
            <p style="margin-bottom: 35px;">© gwt 2021.12.18</p>
            <span id="updvis" onclick="showData('updvis')" style="display: block; position: absolute; bottom: 0; margin: 0 0 10px 45px; color: rgb(84, 127, 219);">更新记录</span>
        </div>
        <div id="right">
            <div id="toolbar" style="border-bottom: 1px solid gray; height: 100px;">
                <div class="alert alert-danger hide" id="alert_div"
                    style="width: 300px; position: fixed; top: 40%;left: 50%; right: 50%;z-index: 1; font-size: 22px;">
                </div> <!-- 警告弹出框 -->
                <div id="right_insert" style="display: none;">
                    <table class="table">
                        <tr>
                            <th>用户名</th>
                            <th>项目名字</th>
                            <th>标注方</th>
                            <th>任务ID</th>
                            <th>日期</th>
                            <th>任务类型</th>
                            <th>图片/视频数量</th>
                            <th>框数/属性/时长</th>
                            <th>工时</th>
                            <th>按钮</th>
                        </tr>
                        <tr>
                            <td><input type="text" name="uname" class="form-control" id="uname_insert"
                                    readonly="readonly"></td>
                            <td><select class="form-control" name="pname" id="pname_insert"> </select></td>
                            <td><select class="form-control" name="waibao" id="waibao_insert"></select> </td>
                            <td><input type="number" name="task_id" min="0" class="form-control" id="task_id_insert">
                            </td>
                            <td><input type="date" name="dtime" class="form-control" id="riqi_insert"></td>
                            <td><select class="form-control" name="kinds" id="kinds_insert"></select></td>
                            <td><input type="number" name="pnums" min="0" class="form-control" id="pnums_insert"></td>
                            <td><input type="text" name="knums" min="0" class="form-control" placeholder="123/00:00:00"
                                    id="knums_insert"></td>
                            <td><input type="number" min="0" step="0.0001" name="ptimes" class="form-control" required='required'
                                    id="ptimes_insert"></td>
                            <td><button class="btn btn-primary" id="btn_insert"><i class="fa fa-plus-square"></i>
                                    添加</button></td>
                        </tr>
                    </table>
                </div>
                <div id="right_search">
                    <table class="table">
                        <tr>
                            <th>用户名</th>
                            <th>项目名字</th>
                            <th>标注方</th>
                            <th>任务ID</th>
                            <th>任务类型</th>
                            <th>开始时间</th>
                            <th>结束时间</th>
                            <th style="text-align: center;">按钮</th>
                        </tr>
                        <tr>
                            <td>
                                <select class="form-control" name="uname" id="uname_search">
                                    <option value="---">---</option>
                                </select>
                            <td>
                                <select class="form-control" name="pname" id="pname_search">
                                    <option value="---">---</option>
                                </select>
                            </td>
                            <td>
                                <select class="form-control" name="bzf" id="bzf_search">
                                    <option value="---">---</option>
                                </select>
                            </td>
                            <td><input type="number" class="form-control" min="0" name="taskid" id="taskid_search"></td>
                            <td>
                                <select class="form-control" name="taskkind" id="taskkind_search">
                                    <option value="---">---</option>
                                </select>
                            </td>
                            <td><input type="date" name="dtime" class="form-control" id="begin_time_search"></td>
                            <td><input type="date" name="lasttime" class="form-control" id="last_time_search"></td>
                            <td>
                                <input type="reset" class="btn btn-default pull-left" id="reset" value="重置">
                                <input type="button" class="btn btn-primary pull-right" id="serch" value="查询">
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <!--工具栏(每行)-->
            <script type="text/html" id="barDemo">
                <a class="layui-btn layui-btn-xs" lay-event="edit"><i class="fa fa-pencil"></i> 编辑</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i class="fa fa-remove"></i> 删除</a>
            </script>
            <table class="layui-hide" id="test" lay-filter="test"></table>
            <!-- 弹窗之ESS-Info -->
            <div class="modal fade" tabindex="-1" role="dialog" id="ess_info">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title" style="color: rgb(68, 147, 199);">
                                <i class="fa fa-info-circle"></i> ESS-INFO
                            </h3>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <p>
                                    ESS 是一款统计性的功能平台<br>
                                    主要有记录个人平时的工作内容，工作量，工作效率，绩效等<br>
                                    也可以统计给供应商发送的数据量，各供应商在每个项目上所用的费用等
                                </p>
                            </div>
                            <div class="form-group">
                                <p>
                                    <span class="ant-typography"><strong>Font-Awesome version:</strong></span>
                                    <span class="ant-typography ant-typography-secondary"> 4.7.0</span>
                                </p>
                            </div>
                            <div class="form-group">
                                <p>
                                    <span class="ant-typography"><strong>Echarts version:</strong></span>
                                    <span class="ant-typography ant-typography-secondary"> 5.4.1</span>
                                </p>
                            </div>
                            <div class="form-group">
                                <p>
                                    <span class="ant-typography"><strong>Pyecharts version:</strong></span>
                                    <span class="ant-typography ant-typography-secondary"> 2.0.1</span>
                                </p>
                            </div>
                            <div class="form-group">
                                <p>
                                    <span class="ant-typography"><strong>Bootstrap version:</strong></span>
                                    <span class="ant-typography ant-typography-secondary"> 3.4.1</span>
                                </p>
                            </div>
                            <div class="form-group">
                                <p>
                                    <span class="ant-typography"><strong>jQuery version:</strong></span>
                                    <span class="ant-typography ant-typography-secondary"> 2.1.4</span>
                                </p>
                            </div>
                            <div class="form-group">
                                <p>
                                    <span class="ant-typography"><strong>Layui version:</strong></span>
                                    <span class="ant-typography ant-typography-secondary"> 2.7.6</span>
                                </p>
                            </div>
                            <div class="form-group">
                                <p>
                                    <span class="ant-typography"><strong>Django version:</strong></span>
                                    <span class="ant-typography ant-typography-secondary"> 3.2.14</span>
                                </p>
                            </div>
                            <div class="modal-footer">
                                <a href="https://github.com/gwt805/myess/tree/master" target="_blank"
                                    style="position: absolute; left: 20px;"><i
                                        class="fa fa-github-square fa-2x" style="color: black;"></i></a>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                                    style="color: blue;">
                                    <span aria-hidden="true">OK</span>
                                </button>
                            </div>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->
            <!-- 弹窗之数据修改 -->
            <div class="modal fade" tabindex="-1" role="dialog" id="gs_update_model">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                            <h3 class="modal-title">修改数据</h3>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-warning" id="err_msg" style="display: none;"></div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">ID:</label>
                                <input type="number" min="0" class="form-control" name="id" readonly="readonly"
                                    id="id_update">
                            </div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">用户名:</label>
                                <input type="text" class="form-control" name="uname" readonly="readonly"
                                    id="uname_update">
                            </div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">项目名字:</label>
                                <select class="form-control" name="pname" id="pname_update"></select>
                            </div>
                            <div class="form-group">
                                <label for="message-text" class="control-label">标注方:</label>
                                <select class="form-control" name="waibao" id="waibao_update"></select>
                            </div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">任务ID:</label>
                                <input type="number" min="0" class="form-control" name="task_id" id="task_id_update">
                            </div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">日期:</label>
                                <input type="date" class="form-control" name="dtime" id="dtime_update">
                            </div>
                            <div class="form-group">
                                <label for="message-text" class="control-label">任务类型:</label>
                                <select class="form-control" name="kinds" id="kinds_update"></select>
                            </div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">图片/视频数量:</label>
                                <input type="number" min="0" class="form-control" name="pnums" id="pnums_update">
                            </div>
                            <div class="form-group">
                                <label for="recipient-name" class="control-label">框数/属性/时长:</label>
                                <input type="text" class="form-control" name="knums" id="knums_update">
                            </div>
                            <div class="form-group">
                                <label for="message-text" class="control-label">工时:</label>
                                <input type="number" min="0" step="0.0001" class="form-control" name="ptimes" id="ptimes_update">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal"
                                    id="btn-miss">取消</button>
                                <button type="submit" class="btn btn-primary" id="btn-update">修改</button>
                            </div>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->
        </div><!-- /.modal -->
    </div>
</body>
<script src="/static/js/disable.js"></script>
<script src="/static/js/click_yh.js"></script>
<script>
    const unames = JSON.parse('{{ unames|safe }}')   // 用户列表
    const projects = JSON.parse('{{ projects|safe }}'); // 项目名字
    const tkinds = JSON.parse('{{ tkinds|safe }}'); // 任务类型 列表
    const bzf = JSON.parse('{{ bzf|safe }}'); // 数据标注方
    let tmpobj=null; // table row 高亮用
    search_show();
    const table = layui.table;
    //渲染表格
    table.render({//渲染table
        url: '/gsalldata',     //数据获取url
        method: 'GET',         //数据传输方式为post
        elem: '#test',         //设置容器
        // toolbar: '#toolbar',
        height: 'full-185',    //高度为屏幕高度-20
        page: true,
        request: {
            pageName: 'pageIndex',  // 页码的参数名称，默认：page
            limitName: 'pageSize'   // 每页数据量的参数名，默认：limit
        },
        response: {
            statusName: 'code',     // 规定数据状态的字段名称，默认：code
            statusCode: 0,          // 规定成功的状态码，默认：0
            msgName: 'msg',         // 规定状态信息的字段名称，默认：msg
            countName: 'count', // 规定数据总数的字段名称，默认：count
            dataName: 'data'        // 规定数据列表的字段名称，默认：data
        },
        page: {
            layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'],     // 自定义分页布局
            curr: 1,      // 设置默认起始页1
            groups: 3,   //只显示10个连续页码,就是说显示10个可见页其他的省略
            first: '首页', // 不显示首页
            last: '尾页'   // 不显示尾页
        },
        limit: 20,
        limits: [20, 50, 100],
        skin: 'row', //表格风格
        even: true,    //隔行换色
        cols: [[               //设置列标签、标题、宽度、是否排序等
            // {checkbox:true}, // 复选框
            { field: 'id', title: 'ID', fixed: left },
            { field: 'uname', title: '用户名', width: 100 },
            { field: 'pname', title: '项目名字', },
            { field: 'waibao', title: '标注方', },
            { field: 'task_id', title: '任务ID', },
            { field: 'dtime', title: '日期' },
            { field: 'kinds', title: '任务类型', },
            { field: 'pnums', title: '图片/视频数量', },
            { field: 'knums', title: '框数/属性/时长', },
            { field: 'ptimes', title: '工时' },
            { fixed: 'right', title: '操作', toolbar: '#barDemo' },//设置每行的工具栏以及其容器
        ]],
    });
    // 点击行高亮
    table.on('row(test)', function(obj){
        $(".active-tr").removeClass("active-tr");
        obj.tr.addClass("active-tr");
        //定义单击行改变行的背景颜色
        if (tmpobj!=null){
            tmpobj.tr[0].style='background-color: #ffffff;';
            tmpobj.tr[0].style = 'border: 1px solid black;'
            if (tmpobj.tr[1]){
                tmpobj.tr[1].style='background-color: #ffffff;';
                tmpobj.tr[1].style = 'border:1px solid black;';
            }
        }
        tmpobj=obj;
        obj.tr[0].style='background-color: #b8e2f3;';
        if (obj.tr[1]){
            obj.tr[1].style='background-color: #b8e2f3;';
        }
    })
    // 表格后台过滤
    $('#serch').click(function () {
        const uname = $('#uname_search').val();
        const pname = encodeURIComponent($('#pname_search option:selected').val()); //.replace("&","%26");
        const bzf = $('#bzf_search option:selected').val();
        const taskid = $("#taskid_search").val();
        const taskkind = $('#taskkind_search option:selected').val();
        const begin_time = $("#begin_time_search").val();
        const last_time = $("#last_time_search").val();
        let url = '/gsalldata?uname=' + uname + '&pname=' + pname + "&bzf=" + bzf + "&taskid=" + taskid + "&taskkind=" + taskkind + "&begin_time=" + begin_time + "&last_time=" + last_time; //第一种方法
        table.reload('test', {
            url: url,
            page: {
                curr: 1 //重新从第 1 页开始
            }
        });
    });
    // 表格过滤重置
    $("#reset").click(function () {
        let url = '/gsalldata'
        table.reload('test', {
            url: url,
            page: {
                curr: 1 //重新从第 1 页开始
            }
        });
        $('#uname_search').find('option:first').prop("selected", "selected");
        $('#pname_search').find('option:first').prop("selected", "selected");
        $('#bzf_search').find('option:first').prop("selected", "selected");
        $("#taskid_search").val("");
        $('#taskkind_search').find('option:first').prop("selected", "selected");
        $("#begin_time_search").val("");
        $("#last_time_search").val("");
    })
    // 操作栏-编辑/删除
    table.on('tool(test)', function (obj) { // 双击 toolDouble
        var data = obj.data;
        // console.log(obj.data)
        if (obj.event === 'del') {
            if (sessionStorage.getItem("power") != '1') {
                $(".alert-danger").html("您没有删除数据权限!");
                $(".alert-danger").addClass("show");
                window.setTimeout(function () {
                    $(".alert-danger").removeClass("show");
                }, 1000);//显示的时间
            }
            else {
                layer.confirm('真的删除行么', function (index) {
                    $.ajax("/dtdel/", {
                        method: "GET",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: {
                            n: $("#name").text(),
                            id: obj.data.id
                        },
                    }).done(function (res) {
                        if (res && res.data == "successful") {
                            let url = '/gsalldata'
                            table.reload('test', { url: url, page: { curr: 1 } });//重新从第 1 页开始
                            $(".alert-danger").html("ID: " + obj.data.id + " 删除成功!");
                            $(".alert-danger").addClass("show");
                            window.setTimeout(function () {
                                $(".alert-danger").removeClass("show");
                            }, 1000);//显示的时间
                        }
                        else {
                            $(".alert-danger").html("ID: " + obj.data.id + " 删除失败!");
                            $(".alert-danger").addClass("show");
                            window.setTimeout(function () {
                                $(".alert-danger").removeClass("show");
                            }, 1000);//显示的时间
                        }
                    });

                    layer.close(index);
                });
            }
        }
        else if (obj.event === 'edit') {// 数据修改
            if (sessionStorage.getItem("power") == '3') {
                $(".alert-danger").html("您没有修改数据权限!");
                $(".alert-danger").addClass("show");
                window.setTimeout(function () {
                    $(".alert-danger").removeClass("show");
                }, 1000);//显示的时间
            }
            else {
                if (obj.data.uname != $('#name').text()) {
                    $(".alert-danger").html("您只能修改自己的数据喔!");
                    $(".alert-danger").addClass("show");
                    window.setTimeout(function () {
                        $(".alert-danger").removeClass("show");
                    }, 1000);//显示的时间
                }
                else {
                    $('#gs_update_model').modal('show');
                    $("#err_msg").css("display", 'none');
                    $.ajax("/update", {
                        method: "GET",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        data: {
                            id: obj.data.id
                        },
                    }).done(function (res) {
                        if (res && res.status == "successful") {
                            const id = res.data[0].id;
                            const uname = res.data[0].uname;
                            const pname = res.data[0].pname;
                            const waibao = res.data[0].waibao;
                            const task_id = res.data[0].task_id;
                            const dtime = res.data[0].dtime;
                            const kinds = res.data[0].kinds;
                            const pnums = res.data[0].pnums;
                            const knums = res.data[0].knums;
                            const ptimes = res.data[0].ptimes;
                            $("#id_update").val(id);
                            $("#uname_update").val(uname);
                            $("#pname_update").html("<option value=" + pname + ">" + pname + "</option>")
                            $("#waibao_update").html("<option value=" + waibao + ">" + waibao + "</option>")
                            $("#task_id_update").val(task_id);
                            $("#dtime_update").val(dtime);
                            $("#kinds_update").html("<option value=" + kinds + ">" + kinds + "</option>")
                            $("#pnums_update").val(pnums);
                            $("#knums_update").val(knums);
                            $("#ptimes_update").val(ptimes);
                            // 给数据标注方 赋值
                            let bzfs1 = document.getElementById('waibao_update');
                            for (var i = 0; i < bzf.length; i++) {
                                if (bzfs1.length < bzf.length) { // 这里不判断的话会一直添加
                                    if (bzf[i] != document.getElementById("waibao_update").value) {
                                        var objOption = document.createElement("option");
                                        objOption.value = bzf[i];
                                        objOption.text = bzf[i];
                                        bzfs1.add(objOption);
                                    };
                                };
                            };
                            // 给项目名字 添加下拉框
                            let p_s1 = document.getElementById('pname_update');
                            for (var i = 0; i < projects.length; i++) {
                                if (p_s1.length < projects.length) { // 这里不判断的话会一直添加
                                    if (projects[i] != document.getElementById("pname_update").value) {
                                        var objOption = document.createElement("option");
                                        objOption.value = projects[i];
                                        objOption.text = projects[i];
                                        p_s1.add(objOption);
                                    };
                                };
                            };
                            // 给任务类型 赋值
                            let tk_s1 = document.getElementById('kinds_update');
                            for (var i = 0; i < tkinds.length; i++) {
                                if (tk_s1.length < tkinds.length) { // 这里不判断的话会一直添加
                                    if (tkinds[i] != document.getElementById("kinds_update").value) {
                                        var objOption = document.createElement("option");
                                        objOption.value = tkinds[i];
                                        objOption.text = tkinds[i];
                                        tk_s1.add(objOption);
                                    };
                                };
                            };
                        }
                    });
                }
            }
        }
    });

    // 添加数据
    function add_data_show() {
        if ($('#right_search').css('display') == 'block') {
            $('#right_search').css("display", "none");
            $('#right_insert').css("display", "block");
        }
        // 给用户名赋值
        $("#uname_insert").val($("#name").text());
        // 添加数据之 日期组件默认为当天日期
        var mydateInput = document.getElementById("riqi_insert");
        var now = new Date();
        var day = ('0' + now.getDate()).slice(-2);
        var month = ('0' + (now.getMonth() + 1)).slice(-2);
        var today = now.getFullYear() + '-' + (month) + '-' + (day);
        mydateInput.value = today;

        // 给数据标注方 赋值
        var bzfs = document.getElementById('waibao_insert');
        for (var i = 0; i < bzf.length; i++) {
            if (bzfs.length < bzf.length) { // 这里不判断的话会一直添加
                if (bzf[i] != document.getElementById("waibao_insert").value) {
                    var objOption = document.createElement("option");
                    objOption.value = bzf[i];
                    objOption.text = bzf[i];
                    bzfs.add(objOption);
                };
            };
        };
        // 给项目名字 添加下拉框
        var p_s = document.getElementById('pname_insert');
        for (var i = 0; i < projects.length; i++) {
            if (p_s.length < projects.length) { // 这里不判断的话会一直添加
                if (projects[i] != document.getElementById("pname_insert").value) {
                    var objOption = document.createElement("option");
                    objOption.value = projects[i];
                    objOption.text = projects[i];
                    p_s.add(objOption);
                };
            };
        };
        // 给任务类型 赋值
        var tk_s = document.getElementById('kinds_insert');
        for (var i = 0; i < tkinds.length; i++) {
            if (tk_s.length < tkinds.length) { // 这里不判断的话会一直添加
                if (tkinds[i] != document.getElementById("kinds_insert").value) {
                    var objOption = document.createElement("option");
                    objOption.value = tkinds[i];
                    objOption.text = tkinds[i];
                    tk_s.add(objOption);
                };
            };
        };
    }
    // 添加数据--
    function month_sw(m){
        if (Number(m) < 10)return '0' + m;
        else return m;
    }
    $("#btn_insert").click(function () {
        if (sessionStorage.getItem("power") == '3') {
            $(".alert-danger").html("您没有权限添加数据!");
            $(".alert-danger").addClass("show");
            window.setTimeout(function () {
                $(".alert-danger").removeClass("show");
            }, 1000);//显示的时间
        } else {
            const uname = $("#uname_insert").val();
            const pname = $("#pname_insert option:selected").val();
            const waibao = $("#waibao_insert option:selected").val();
            const task_id = $("#task_id_insert").val();
            const dtime = $("#riqi_insert").val();
            const kinds = $("#kinds_insert option:selected").val();
            const pnums = $("#pnums_insert").val();
            const knums = $("#knums_insert").val();
            const ptimes = $("#ptimes_insert").val();

            $.ajax("/insert/", {
                method: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: {
                    uname: uname,
                    pname: pname,
                    waibao: waibao,
                    task_id: task_id,
                    dtime: dtime,
                    kinds: kinds,
                    pnums: pnums,
                    knums: knums,
                    ptimes: ptimes
                },
            }).done(function (res) {
                if (res && res.data == "successful") {
                    $("#task_id_insert").val("");
                    $("#pnums_insert").val("");
                    $("#knums_insert").val("");
                    $("#ptimes_insert").val("");
                    var d = new Date();
                    let today = ''
                    const year = d.getFullYear();
                    const month = d.getMonth() + 1;
                    let day = d.getDate();
                    if (day < 10) {
                        day = "0" + day;
                    }
                    today = today + year + '-' + month_sw(month) + '-' + day;
                    let url = '/gsalldata?uname=' + uname + "&pname=---&bzf=---&taskid=&taskkind=---&begin_time=" + today + "&last_time="; //第一种方法
                    table.reload('test', { url: url, page: { curr: 1 } });//重新从第 1 页开始

                    $(".alert-danger").html("添加成功!");
                    $(".alert-danger").addClass("show");
                    $("#alert_div").css("background-color", 'rgb(21, 150, 90)');
                    $("#alert_div").css("color", 'rgb(255, 255, 255)');
                    window.setTimeout(function () {
                        $(".alert-danger").removeClass("show");
                    }, 1000);//显示的时间
                } else {
                    $(".alert-danger").html(res.data);
                    $(".alert-danger").addClass("show");
                    window.setTimeout(function () {
                        $(".alert-danger").removeClass("show");
                    }, 1500);//显示的时间
                }
            });
        }
    })
    // 修改数据
    $("#btn-update").click(function () {
        const id = $("#id_update").val();
        const uname = $("#uname_update").val();
        const pname = $("#pname_update option:selected").val();
        const waibao = $("#waibao_update option:selected").val();
        const task_id = $("#task_id_update").val();
        const dtime = $("#dtime_update").val();
        const kinds = $("#kinds_update option:selected").val();
        const pnums = $("#pnums_update").val();
        const knums = $("#knums_update").val();
        const ptimes = $("#ptimes_update").val();
        $.ajax("/update/", {
            method: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: {
                id: id,
                uname: uname,
                pname: pname,
                waibao: waibao,
                task_id: task_id,
                dtime: dtime,
                kinds: kinds,
                pnums: pnums,
                knums: knums,
                ptimes: ptimes
            },
        }).done(function (res) {
            if (res && res.status == "successful") {
                $("#btn-miss").click();
                $(".alert-danger").html("修改成功!");
                $(".alert-danger").addClass("show");
                $("#alert_div").css("background-color", 'rgb(21, 150, 90)');
                $("#alert_div").css("color", 'rgb(255, 255, 255)');
                window.setTimeout(function () {
                    $(".alert-danger").removeClass("show");
                }, 1000);//显示的时间

                var d = new Date();
                let today = ''
                const year = d.getFullYear();
                const month = d.getMonth() + 1;
                let day = d.getDate();
                if (day < 10) {
                    day = "0" + day;
                }
                today = today + year + '-' + month + '-' + day;
                let url = '/gsalldata?uname=' + uname + "&pname=---&bzf=---&taskid=&taskkind=---&begin_time=" + today + "&last_time="; //第一种方法
                table.reload('test', { url: url, page: { curr: 1 } });//重新从第 1 页开始
            } else {
                $("#err_msg").css("display", 'block');
                $("#err_msg").html(res.mes);

            }
        });
    })
    // 搜索数据
    function search_show() {
        if ($('#right_insert').css('display') == 'block') {
            $('#right_insert').css("display", "none");
            $('#right_search').css("display", "block");
        }
        // 给开始时间赋值
        $("#begin_time_search").val("2021-12-27");
        // last_time_search 
        // 给用户 添加下拉框
        var u_n = document.getElementById('uname_search');
        for (var i = 0; i < unames.length; i++) {
            if (u_n.length < unames.length + 1) { // 这里不判断的话会一直添加
                if (unames[i] != document.getElementById("uname_search").value) {
                    var objOption = document.createElement("option");
                    objOption.value = unames[i];
                    objOption.text = unames[i];
                    u_n.add(objOption);
                };
            };
        };
        // 给项目名字 添加下拉框
        var p_s = document.getElementById('pname_search');
        for (var i = 0; i < projects.length; i++) {
            if (p_s.length < projects.length + 1) { // 这里不判断的话会一直添加
                if (projects[i] != document.getElementById("pname_search").value) {
                    var objOption = document.createElement("option");
                    objOption.value = projects[i];
                    objOption.text = projects[i];
                    p_s.add(objOption);
                };
            };
        };
        // 给标注方 添加下拉框
        var bzf_s = document.getElementById('bzf_search');
        for (var i = 0; i < projects.length; i++) {
            if (bzf_s.length < bzf.length + 1) { // 这里不判断的话会一直添加
                if (bzf[i] != document.getElementById("bzf_search").value) {
                    var objOption = document.createElement("option");
                    objOption.value = bzf[i];
                    objOption.text = bzf[i];
                    bzf_s.add(objOption);
                };
            };
        };
        // 给任务类型 添加下拉框
        var taskkind_s = document.getElementById('taskkind_search');
        for (var i = 0; i < projects.length; i++) {
            if (taskkind_s.length < tkinds.length + 1) { // 这里不判断的话会一直添加
                if (tkinds[i] != document.getElementById("taskkind_search").value) {
                    var objOption = document.createElement("option");
                    objOption.value = tkinds[i];
                    objOption.text = tkinds[i];
                    taskkind_s.add(objOption);
                };
            };
        };
    }

    // Help
    function help() {
        $(".alert-danger").html("请联系卫龙!");
        $(".alert-danger").addClass("show");
        window.setTimeout(function () {
            $(".alert-danger").removeClass("show");
        }, 1000);//显示的时间
    };
    // setting
    if (sessionStorage.getItem("power") != '1'){
        $("#nav_setting").css('display', 'none')
    }
    else {
        $("#nav_setting").css('display', 'block')
    }
    // 关于
    function info() {
        $('#ess_info').modal('show');
    }

    // 退出登录
    function logout() {
        sessionStorage.setItem("isLogin", "");
        sessionStorage.setItem("zhuname", "");
        sessionStorage.setItem("power", "");
        window.location.href = '/login'
    }

    // 整合
    function showData(flag) {
        if (flag == 'gsdata_count') {
            window.location.href = '/' + flag;
        } else if (flag == 'efficiency') {
            window.location.href = '/' + flag;
        } else if (flag == 'performance') {
            window.location.href = '/' + flag;
        } else if (flag == 'updvis') {
            window.open("https://github.com/gwt805/myess/blob/master/CHANGELOG.md", "_blank");
        }
    }
</script>

</html>